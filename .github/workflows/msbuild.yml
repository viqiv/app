name: macOS

on:
  workflow_dispatch:

jobs:
  build-macos:
    runs-on: macos-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Install dependencies via Homebrew
      run: |
        brew update
        brew install cmake ninja qt@6

    - name: Set up environment for Qt
      run: |
        echo "/opt/homebrew/opt/qt@6/bin" >> $GITHUB_PATH
        echo "CMAKE_PREFIX_PATH=/opt/homebrew/opt/qt@6" >> $GITHUB_ENV

    - name: Configure with CMake
      run: |
        cmake -S . -B build -G Ninja -DCMAKE_BUILD_TYPE=Release

    - name: Build with Ninja
      run: |
        cmake --build build
        ls -a build
        otool -L build/ZipCombiner.app/Contents/MacOS/ZipCombiner
        otool -L /opt/homebrew/opt/qt/lib/QtCore.framework/Versions/A/QtCore
        otool -L /opt/homebrew/opt/qt/lib/QtGui.framework/Versions/A/QtGui
        otool -L /opt/homebrew/opt/qt/lib/QtWidgets.framework/Versions/A/QtWidgets

    - name: Deploy Qt frameworks into .app bundle
      run: |
        /opt/homebrew/opt/qt/bin/macdeployqt build/ZipCombiner.app -verbose=3
        otool -L build/ZipCombiner.app/Contents/MacOS/ZipCombiner
        ls -a build/ZipCombiner.app/Contents/Frameworks
        ls -a build/ZipCombiner.app/Contents/PlugIns
        

        
        
